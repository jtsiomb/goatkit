#!/bin/sh

prefix=/usr/local
dbg=true
opt=false

while [ $# -gt 0 ]; do
	case $1 in
	--prefix=*)
		prefix=$(echo $1 | sed 's/--prefix=//')
		;;

	--enable-debug)
		dbg=true
		;;
	--disable-debug)
		dbg=false
		;;
	--enable-opt)
		opt=true
		;;
	--disable-opt)
		opt=false
		;;

	--help)
		echo 'Usage: ./configure [options]'
		echo 'Options:'
		echo '  --prefix=<path>: set installation prefix (default: /usr/local)'
		echo '  --enable-X/--disable-X, where X might be:'
		echo '    opt: performance optimizations'
		echo '    debug: include debug symbols'
		echo '  --help: show this usage info and exit'
		exit 0
	esac
	shift
done

echo "prefix: $prefix"
$opt && echo 'optimizations: on' || echo 'optimizations: off'
$dbg && echo 'debug symbols: on' || echo 'debug symbols: off'

echo 'generating Makefile...'
echo '# Auto-generated by configure, edit Makefile.in instead!' >Makefile
echo "PREFIX = $prefix" >>Makefile
$opt && echo 'cfg_optim = 1' >>Makefile
$dbg && echo 'cfg_dbg = 1' >>Makefile
cat Makefile.in >>Makefile

echo 'generating config.h...'
echo '#ifndef GOATKIT_CONFIG_H_' >config.h
echo '#define GOATKIT_CONFIG_H_' >>config.h
echo '#define PREFIX "'${prefix}'"' >>config.h
echo '#endif /* GOATKIT_CONFIG_H_ */' >>config.h

echo 'done, type make (or gmake) to build.'
